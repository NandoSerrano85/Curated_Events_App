# NATS Server Configuration for Events Platform
# Optimized for Go microservices communication

# Server settings
server_name: "events-platform-nats"
listen: "0.0.0.0:4222"
client_advertise: "localhost:4222"

# HTTP monitoring
http_port: 8222
http: "0.0.0.0:8222"

# Logging
log_file: "/var/log/nats/nats-server.log"
log_size_limit: 64MB
log_file_count: 5
logtime: true
debug: false
trace: false
syslog: false

# Connection limits
max_connections: 1000
max_control_line: 4KB
max_payload: 1MB
max_pending: 64MB

# Authentication (development - use JWT in production)
# authorization {
#   default_permissions = {
#     publish = ["events.>", "users.>", "notifications.>", "search.>", "websocket.>", "payments.>"]
#     subscribe = ["events.>", "users.>", "notifications.>", "search.>", "websocket.>", "payments.>"]
#   }
# }

# Clustering (for production high availability)
cluster {
  name: "events-platform-cluster"
  listen: "0.0.0.0:6222"
  
  # Routes to other servers in cluster
  # routes = [
  #   "nats://nats-server-1:6222"
  #   "nats://nats-server-2:6222"
  # ]
  
  # Cluster advertise
  cluster_advertise: "localhost:6222"
  
  # Connect retries
  connect_retries: 10
}

# JetStream (for persistent messaging)
jetstream {
  # Enable JetStream
  enabled: true
  
  # Storage directory
  store_dir: "/var/lib/nats/jetstream"
  
  # Memory and file storage limits
  max_memory_store: 256MB
  max_file_store: 2GB
  
  # Domain (for multi-tenancy)
  domain: "events-platform"
}

# WebSocket support (for browser clients)
websocket {
  port: 8080
  no_tls: true
  
  # Compression
  compression: true
  
  # Origins (CORS)
  same_origin: false
  allowed_origins: [
    "http://localhost:3000",
    "http://localhost:8080",
    "https://events-platform.com"
  ]
}

# Performance tuning
# Write deadline for client connections
write_deadline: "10s"

# Ping settings
ping_interval: "2m"
ping_max: 2

# Slow consumer settings
max_slow_consumers: 100
slow_consumer_threshold: "1s"

# Performance and reliability
no_auth_user: "events-platform"

# TLS Configuration (production)
# tls {
#   cert_file: "/etc/ssl/certs/nats-server.crt"
#   key_file: "/etc/ssl/private/nats-server.key"
#   ca_file: "/etc/ssl/certs/ca.crt"
#   verify: true
#   cipher_suites: [
#     "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
#     "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
#   ]
#   curve_preferences: [
#     "CurveP256"
#   ]
#   timeout: 3
# }

# Limits
# Per-connection limits
max_subscriptions: 10000
max_msgs: 1000000

# System limits
max_bytes: 64MB
max_age: "24h"

# Enable profiling (development only)
prof_port: 6060